_Начальные данные_:

1. Gunicorn: 1 воркер, каждый работает в один поток
2. Запущен только один инстанс сервера
3. Докеру доступно 2 ядра, 4гб оперативки
4. В таблице _app_book_ 10^6 записей

В качестве нагрузчика использовал **Apache jmeter**
_.jmx_ jmeter файл лежит в `./jmeter_conf_files/get_books.jmx`

### URLS

**get_specific_books**
url = `/get_books/`
body data = `{ "book_titles": ["title_${__Random(0,999999)}", "title_${__Random(0,999999)}", "title_${__Random(0,999999)}"]}`

### Тестирование

Тут для упрощения я привожу только изменения по _throughput_. Более полные данные можно посмотреть в ./full*results/<номер*пункта>

1. **На начальных данных**

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 15.9              |

2. **Увеличиваем количество воркеров гуникорна с 1 до 5**

> (2\*num_cores) + 1 = 5

    | url_name           | throughput , /sec |
    | ------------------ | ----------------- |
    | get_specific_books | 15.1              |

3. **Добавляем индекс на поле _title_ таблицы _book_**

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 184.5             |

4. **Добавляем кеширование в редис**

   1. При большом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 179.7             |

   2. При малом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 1220.0            |

Почему результат не улучшился (п.4.1.):
Все дело в том, что каждый пользователь в request.body указывает случайноe значение title, которое лежит в очень большом диапазоне значений. Т.е. шанс, что мы попадем на значение, которое есть в кеше минимальный.
Попробуем сократить диапазон возможных значений с 10 \*\* 6 до 10 (п.4.2.), т.е. body data = `{ "book_titles": ["title_${__Random(0,10)}", "title_${__Random(0,10)}", "title_${__Random(0,10)}"]}`

5. **Запускаем сервер в 4 инстанса**

   1. При большом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 166.2             |

   2. При малом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 1512.5            |

**Актуальный вопросы**:

1. Почему 2 пункт не дал никаких улучшений?
2. Почему 5 пункт не дал никаких улучшений?

**Предположения**:

1. Не хватает мощности

**Решения:**

> Более полные результаты лежат в `./full_results/solutions/<номер_решения>/<номер_пункта>`

#### 1. Увеличим кол-во ядер, доступных докеру до 8, оперативную память до 8 гб и проведем ровно те же эксперименты

1. **На начальных данных**
   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 20.3              |

2. **Увеличиваем количество воркеров гуникорна с 1 до 5**

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 46.4              |

3. **Добавляем индекс на поле _title_ таблицы _book_**

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 427.2             |

4. **Добавляем кеширование в редис**

   1. При большом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 402.3             |

   2. При малом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 2475.0            |

5. **Запускаем сервер в 4 инстанса**

   1. При большом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 426.3             |

   2. При малом диапазоне случайных чисел

   | url_name           | throughput , /sec |
   | ------------------ | ----------------- |
   | get_specific_books | 5029.9            |

**Вывод:** изменения в пункте 2 и 5 дают результаты, предположительно догадка была верна.

**TODO**: надо добавить мониторинг сервера
